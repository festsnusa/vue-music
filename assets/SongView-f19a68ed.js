import{r as d,o as i,c as m,a as e,i as x,t as n,n as y,m as u,h as v,w as C,b as _,f as k,p as S,F as D,g as P,_ as V,q as E,u as F,s as h,l as g,x as b,y as q,z as M,E as z}from"./index-2a1f2f96.js";const B={class:"w-full mb-8 py-14 text-center text-white relative"},I=e("div",{class:"absolute inset-0 w-full h-full box-border bg-contain music-bg",style:{"background-image":"url(/assets/img/song-header.png)"}},null,-1),L={class:"container mx-auto flex items-center"},N=e("i",{class:"fas fa-play"},null,-1),U=[N],Y={class:"z-50 text-left ml-8"},j={class:"text-3xl font-bold"},A={class:"song-price"},O={class:"container mx-auto mt-6",id:"comments"},R={class:"bg-white rounded border border-gray-200 relative flex flex-col"},G={class:"px-6 pt-6 pb-5 font-bold border-b border-gray-200"},H={class:"card-title"},J=e("i",{class:"fa fa-comments float-right text-green-400 text-2xl"},null,-1),K=e("div",{class:"p-6"},null,-1),Q=["disabled"],T=e("option",{value:"1"},"Latest",-1),W=e("option",{value:"2"},"Oldest",-1),X=[T,W],Z={class:"container mx-auto"},$={class:"mb-5"},ee={class:"font-bold"};function te(s,o,c,l,t,a){const p=d("VeeField"),f=d("ErrorMessage"),w=d("VeeForm");return i(),m("main",null,[e("section",B,[I,e("div",L,[e("button",{class:"z-50 h-24 w-24 text-3xl bg-white text-black rounded-full focus:outline-none",type:"button",onClick:o[0]||(o[0]=x(r=>s.newSong(t.song),["prevent"]))},U),e("div",Y,[e("div",j,n(t.song.modified_name),1),e("div",null,n(t.song.genre),1),e("div",A,n(s.$n(1,"currency","ja")),1)])])]),e("section",O,[e("div",R,[e("div",G,[e("span",H,n(s.$tc("song.comment_count",t.song.comment_count,{count:t.song.comment_count})),1),J]),K,t.comment_show_alert?(i(),m("div",{key:0,class:y(["text-white text-center font-bold p-4 mb-4",t.comment_alert_variant])},n(t.comment_alert_message),3)):u("",!0),s.userLoggedIn?(i(),v(w,{key:1,"validation-schema":t.schema,onSubmit:a.addComment},{default:C(()=>[_(p,{class:"block w-full py-1.5 px-3 text-gray-800 border border-gray-300 transition duration-500 focus:outline-none focus:border-black rounded mb-4",as:"textarea",name:"comment",placeholder:"Your comment here..."}),_(f,{class:"text-red-600",name:"comment"}),e("button",{class:"py-1.5 px-3 rounded text-white bg-green-600 block",type:"submit",disabled:t.comment_in_submission},"Submit",8,Q)]),_:1},8,["validation-schema","onSubmit"])):u("",!0),k(e("select",{class:"block mt-4 py-1.5 px-3 text-gray-800 border border-gray-300 transition duration-500 focus:outline-none focus:border-black rounded","onUpdate:modelValue":o[1]||(o[1]=r=>t.sort=r)},X,512),[[S,t.sort]])])]),e("ul",Z,[(i(!0),m(D,null,P(a.sortedComments,r=>(i(),m("li",{class:"p-6 bg-gray-50 border border-gray-200",key:r.docID},[e("div",$,[e("div",ee,n(r.name),1),e("time",null,n(r.datePosted),1),e("p",null,n(r.content),1)])]))),128))])])}const se={name:"song-view",computed:{...E(F,["userLoggedIn"]),sortedComments(){return this.comments.slice().sort((s,o)=>this.sort==="1"?new Date(o.datePosted)-new Date(s.datePosted):new Date(s.datePosted)-new Date(o.datePosted))}},data(){return{song:{},schema:{comment:"required|min:3"},comment_in_submission:!1,comment_show_alert:!1,comment_alert_variant:"bg-blue-500",comment_alert_message:"Please wait! Your comment is being submitted",comments:[],sort:"1"}},async beforeRouteEnter(s,o,c){const l=await h.doc(s.params.id).get();c(t=>{if(!l.exists){t.$router.push({name:"home"});return}const{sort:a}=t.$route.query;t.sort=a==="1"||a==="2"?a:"1",t.song=l.data(),t.getComments()})},methods:{async addComment(s,{resetForm:o}){this.comment_in_submission=!0,this.comment_show_alert=!0,this.comment_alert_variant="bg-blue-500",this.comment_alert_message="Please wait! Your comment is being submitted";const c={content:s.comment,datePosted:new Date().toString(),sid:this.$route.params.id,name:g.currentUser.displayName,uid:g.currentUser.uid};await b.add(c),this.song.comment_count+=1,await h.doc(this.$route.params.id).update({comment_count:this.song.comment_count}),this.getComments(),this.comment_in_submission=!1,this.comment_alert_variant="bg-green-500",this.comment_alert_message="Comment added!",o()},async getComments(){const s=await b.where("sid","==",this.$route.params.id).get();this.comments=[],s.forEach(o=>{this.comments.push({docID:o.id,...o.data()})})},...q(M,["newSong"])},watch:{sort(s){s!==this.$route.query.sort&&this.$router.push({query:{sort:s}})}},components:{ErrorMessage:z}},ne=V(se,[["render",te]]);export{ne as default};
